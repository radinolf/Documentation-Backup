# Data Presentation Widgets

## How to create a Data Presentation Widget

In this example, we will create a custom card to show asset information.

Therehore, we are going to create a **Data Predentation** widget and associate a report to getting JSON data.

<figure><img src="../../../.gitbook/assets/image (993).png" alt=""><figcaption></figcaption></figure>

The main steps to create a new Data Presentation widget in DAC are the following:

1. [Create a new Widget](data-presentation-widgets.md#step-1-create-a-new-widget-in-the-widget-catalog)&#x20;
2. [Associate the report](data-presentation-widgets.md#step-2-associate-the-report-to-your-widget)
3. [Define the fields](data-presentation-widgets.md#step-3-define-the-fields-for-mapping-report-columns)
4. [Develop the code](data-presentation-widgets.md#step-4-develop-your-widget-code)
5. [Configure settings](data-presentation-widgets.md#step-5-configure-the-settings-properties)
6. [Publish the widget](data-presentation-widgets.md#step-6-publish-your-widget)
7. [Set up the page in Design Studio](data-presentation-widgets.md#step-7-set-up-your-page-by-using-your-widget-in-the-page-design)
8. [Use the widget on DAC Web Application](data-presentation-widgets.md#step-8-view-your-page-in-dac-web-application)

### Step 1 - Create a new Widget in the Widget Catalog

Open the Widget Catalog Page from the Main Menu:&#x20;

* Select **Widget Designer**
* Click **New Widget**                                                                                                                                                                                                                                                                                                                                                                                                                &#x20;

{% hint style="warning" %}
Only Administrator role can display and open the Widget Editor
{% endhint %}

Fill out the form to insert your widget's information:

* Select the widget type "**Data presentation"** (with report association). This step is mandatory
* Input a mandatory name for the new widget.
* Select the folder in which you want to locate the widget in the catalog.
* Click **Save.**

<figure><img src="../../../.gitbook/assets/image (941).png" alt=""><figcaption></figcaption></figure>

If the widget is successfully created, a confirmation message will be displayed

<figure><img src="../../../.gitbook/assets/image (1804).png" alt="" width="329"><figcaption></figcaption></figure>

Open the newly created widget from the folder where it has been saved:

<figure><img src="../../../.gitbook/assets/image (983).png" alt=""><figcaption></figcaption></figure>

### Step 2 - Associate the report to your widget

Create a simple report datasource that will be used to generate the `mockData.json`

We created a report with one dimensional level and two metrics.

<figure><img src="../../../.gitbook/assets/image (965).png" alt=""><figcaption></figcaption></figure>

Associate the report to your widget:

* &#x20;Select the **SETTINGS** tab --> **Preview mock generation** group
* Under **DATA GENERATION** sub-group select the **Report datasource** previously created and the **Application** where it is located.

<figure><img src="../../../.gitbook/assets/image (969).png" alt=""><figcaption></figcaption></figure>

* Select the **RESOURCES** tab
* Expand the folders: **metadata** --> **mock**--> **mock\_preview**
* Double-click `mockData.json` resource&#x20;
* Click **reload resource** button ![](<../../../.gitbook/assets/image (419).png>) to display the data generated by your report data source association. Refer to the [Widget Resource](widget-resources/) page for more details.

<div data-full-width="true"><figure><img src="../../../.gitbook/assets/image (974).png" alt=""><figcaption></figcaption></figure></div>

### Step 3 - Define the fields for mapping report columns

Define the association between the fields and the reports columns. These will be represented in JSON data in the colMap node:

* Select the **SETTINGS** tab --> **Main** group
* Select the **DATA MODEL** sub-group&#x20;
* Click **Fields definition** property
* Input the fields on **New Field** property
* Set the fields as **Mandatory** by checking the box

<div data-full-width="true"><figure><img src="../../../.gitbook/assets/image (981).png" alt=""><figcaption></figcaption></figure></div>

* Select the **SETTINGS** tab --> **Preview mock generation** group
* Select the **SUPPORTED SETTINGS** sub-group&#x20;
* Click **Fields association** property
* Associate the fields previously defined to map them to the report columns

Upload an image to be associated with the asset information for your custom card:

* Select the **RESOURCES** tab&#x20;
* Right-click **Root**--> select **New folder** from the context menu to create a new folder where locate the image.
* Add a name to the folder ("image", in this example)
* Right-click the "image" folder-->select **Upload Resources** from the context menu to upload a picture ("turbine.png", in this example)

<figure><img src="../../../.gitbook/assets/image (980).png" alt=""><figcaption></figcaption></figure>

### Step 4 - Develop your widget code

#### &#x20;Define the controller code:

* Double-click the `index.js` resource to define the controller code:

{% code fullWidth="true" %}
```javascript
(function() {

    'use strict';

    function CardController($scope) {
        var vm = this;

		var DECISYON_DATA = $scope.DECISYON.target.content.data;
		
		vm.turbineImg = $scope.DECISYON.template.resourcePath + "/image/turbine.png";
		
		var reportProvider = DECISYON_DATA.reportProvider;
		var colMap         = reportProvider.colMap;
		
		vm.rows = DECISYON_DATA.reportProvider.rows;

		vm.assetIdx         = colMap.asset.cellsIdx;
		vm.numberOfAlertsIdx      = colMap.numberOfAlerts.cellsIdx;
		vm.tagValueIdx        = colMap.tagValue.cellsIdx;
	
	    vm.isInline = function(index) {
	        index = index-2;

            if (index%5 == 4) {
	            return false;
	        }

	        return true;
	    };
    }

    DECISYON.ng.register.controller('dcyCardController', CardController);

}());
```
{% endcode %}

<div data-full-width="true"><figure><img src="../../../.gitbook/assets/image (957).png" alt=""><figcaption></figcaption></figure></div>

* Save your code

#### Define the view:

* Double-click the `index.html` resource to define the view:

{% code fullWidth="true" %}
```html
<div id="sparklineFull" ng-controller="dcyCardController as controller">
    <div ng-repeat="row in controller.rows" ng-if="$index > 1" class="inline-box">
        <div class="box-title">{{row.cells[controller.assetIdx].viewVal}}</div>
        <div class="box-details">
            <img class="turbine-img" ng-src="{{controller.turbineImg}}"> 
            <div class="turbine-details">
                <p>Number of alert  : {{row.cells[controller.numberOfAlertsIdx].viewVal}}</p>
                <p>Tag value        : {{row.cells[controller.tagValueIdx].viewVal}}</p>                            
            </div>
        </div>
    </div>
</div>
```
{% endcode %}

* Save your code

#### Define the style:

* Double-click the `index.css` resource to define the widget style:

{% code fullWidth="true" %}
```css
.inline-box {
    display: inline-block;
    width: 300px;
    margin: 10px;
    
    border: 1px solid gray;
}

.inline-box .box-title {
    background-color: #027FF4;
    height: 2em;
    padding: 5px;
    
    font-size: 16px;
    font-weight: bold;
    color: #EEE;
}

.inline-box .box-details {
    position: relative;
}

.inline-box .box-details .turbine-img {
    width: 100px;
}

.inline-box .box-details .turbine-details {
    position: absolute;
    left : 100px;
    top: 0px;
}

.inline-box .box-details .turbine-details p {
    padding-top: 15px;
    padding-left: 10px;
    font-size: 12px;
}
```
{% endcode %}

* Save your code

### Step 5 - Configure the Settings properties

Set the `index.js`  and  `index.css` resources as a dependencies:

* Select the **SETTINGS** tab
* Select **Main settings** --> **DEPS**
* In the **CSS dependences** property, click **Selct file** to select the `index.css` resource &#x20;
* Save
* In the **JS dependences** property, click **Selct file** to select the `index.css` resource &#x20;
* Save

<figure><img src="../../../.gitbook/assets/image (948).png" alt=""><figcaption></figcaption></figure>

View and test your widget in the **Preview** section

* Click the **Preview** button

<div data-full-width="true"><figure><img src="../../../.gitbook/assets/image (958).png" alt=""><figcaption></figcaption></figure></div>

### Step 6 - Publish your widget

Publish the widget and make it available in Page Design in Design Studio.&#x20;

1. Select the **SETTINGS** tab.&#x20;
2. Select the **Main** settings group of properties.
3. Set a new Logical name for the widget ("ReportVisualizationCard", in this example).&#x20;
4. Select the **Published** property.

{% hint style="info" %}
The system automatically gives a default logical name when a new widget is created.&#x20;

We advise modifying the widget's default logical name and assigning the widget a meaningful logical name.&#x20;

For further details on the Logical Name of widgets, go to [Widget Settings](widget-settings.md#logical-name).


{% endhint %}

<div data-full-width="true"><figure><img src="../../../.gitbook/assets/image (947).png" alt=""><figcaption></figcaption></figure></div>

### Step 7 - Set up your page by using your widget in the Page Design

Add the new widget on a page:

* Open the Page Design
* Create a new page and assign a name&#x20;
* Drag your "Report Visualization Card" widget to the page. It is located inside the same folder that was chosen during its creation

<figure><img src="../../../.gitbook/assets/image (988).png" alt=""><figcaption></figcaption></figure>

Set the widget's properties:

* In the **report datasource** property, associate a report to the widget. You can associate the same report used in the Step 2 to generate the `mockData.json`

<figure><img src="../../../.gitbook/assets/image (968).png" alt=""><figcaption></figcaption></figure>

* In the **fields association** property, bind the report columns with the correct fields.&#x20;

<figure><img src="../../../.gitbook/assets/image (970).png" alt=""><figcaption></figcaption></figure>

{% hint style="info" %}
Remember that all of the fields in this example were set as mandatory during the widget's development. Therefore, all fields should be associated with the report columns in the **fields association** dialog.
{% endhint %}

* Save and publish the page.

### Step  8 - Use the widget on DAC web application

Open the page on the DAC Web Application and display your widget.

<div data-full-width="true"><figure><img src="../../../.gitbook/assets/image (937).png" alt=""><figcaption></figcaption></figure></div>
